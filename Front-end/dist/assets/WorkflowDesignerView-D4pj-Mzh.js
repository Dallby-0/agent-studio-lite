import{r as g,h as ie,G as Ne,e as D,c as h,o as x,b as i,d as n,w as d,f as O,F as q,j as W,t as B,H as se,m as ae,s as Ve,k as F,z as xe,q as Ie,E as y,a as he,I as De,i as Se,J as be,K as Je,u as Oe,B as Ce}from"./index-DPyoWTO0.js";import{L as Me}from"./Layout-DHl0ER0W.js";import{_ as ue}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{u as Pe}from"./userStore-G1T_YT5K.js";import{a as Xe,r as Ye,u as Ee,c as $e}from"./workflow-BGyh7tre.js";const Le={class:"workflow-designer"},Ue={class:"designer-toolbar"},ze={class:"workflow-name-input"},Be={class:"toolbar-right"},Re={class:"designer-container"},Te={class:"node-palette"},Ae={class:"node-list"},je=["onDragstart"],qe={class:"node-icon"},Fe={class:"node-label"},He=["x1","y1","x2","y2"],Ge=["onMousedown","onClick"],Ke={class:"node-header"},Ze={class:"node-type-icon"},Qe={class:"node-name"},We={class:"node-actions"},eo={class:"node-type"},oo={class:"node-ports"},lo=["data-node-id","onMousedown"],no=["data-node-id","onMousedown"],to={key:0,class:"temp-connection-layer"},so=["x1","y1","x2","y2"],ao={class:"properties-panel"},io={key:0,class:"workflow-properties"},uo={key:1,class:"properties-content"},ro={__name:"WorkflowDesigner",props:{workflow:{type:Object,default:()=>({})}},emits:["save","run"],setup(ee,{emit:H}){const t=ee,T=H,c=[{type:"start",label:"å¼€å§‹èŠ‚ç‚¹",icon:"â–¶ï¸"},{type:"end",label:"ç»“æŸèŠ‚ç‚¹",icon:"â¹ï¸"},{type:"llm_call",label:"å¤§æ¨¡å‹è°ƒç”¨",icon:"ğŸ¤–"}],u=g([]),r=g([]),w=g(null),f=g(1),V=g(!1),R=g({x:0,y:0}),L=g({x:0,y:0});let U=null;const z=g(null),A=g(null),I=g({}),S=g(t.workflow.name||""),p=g(t.workflow.description||""),s=g(t.workflow.version||"1.0.0"),k=o=>{const e=c.find(a=>a.type===o);return e?e.label:o},b=o=>{const e=c.find(a=>a.type===o);return e?e.icon:"ğŸ“¦"},X=o=>{const e=u.value.find(a=>a.id===o);return e?{x:e.positionX,y:e.positionY}:{x:0,y:0}},j=(o,e)=>{o.dataTransfer.setData("application/json",JSON.stringify(e))},G=o=>{o.preventDefault()},K=o=>{o.preventDefault();const e=o.dataTransfer.getData("application/json");if(e){const a=JSON.parse(e),v=z.value.getBoundingClientRect(),J=(o.clientX-v.left)/f.value-75,m=(o.clientY-v.top)/f.value-30,C={id:-Date.now()%1e6,name:`${a.label} ${u.value.length+1}`,type:a.type,positionX:J,positionY:m,configJson:JSON.stringify({})};u.value.push(C)}},M=o=>{w.value=o,I.value=o.configJson?JSON.parse(o.configJson):{}},de=()=>{},Z=()=>{w.value&&(w.value.configJson=JSON.stringify(I.value))},re=()=>{},ce=()=>{},pe=()=>{},fe=o=>{var e;u.value=u.value.filter(a=>a.id!==o.id),r.value=r.value.filter(a=>a.fromNodeId!==o.id&&a.toNodeId!==o.id),((e=w.value)==null?void 0:e.id)===o.id&&(w.value=null,I.value={}),y.success("èŠ‚ç‚¹å·²åˆ é™¤")},oe=(o,e,a)=>{o.stopPropagation(),a!=="input"&&(V.value=!0,U={from:e.id},o.target.getBoundingClientRect(),R.value={x:e.positionX,y:e.positionY},L.value={x:e.positionX+150,y:e.positionY+30},document.addEventListener("mousemove",le),document.addEventListener("mouseup",ne))},le=o=>{if(!V.value)return;const e=z.value.getBoundingClientRect();L.value={x:(o.clientX-e.left)/f.value,y:(o.clientY-e.top)/f.value}},ne=o=>{if(!V.value)return;const e=o.target.closest(".port-input");if(e){const a=parseInt(e.dataset.nodeId);if(U.from!==a){const v={id:-Date.now()%1e6,fromNodeId:U.from,toNodeId:a};r.value.push(v),console.log("=== è°ƒè¯•ï¼šè¾¹åˆ›å»ºæˆåŠŸ ==="),console.log("æ–°åˆ›å»ºçš„è¾¹:",v),console.log("å½“å‰è¾¹æ•°é‡:",r.value.length),console.log("æ‰€æœ‰è¾¹æ•°æ®:",r.value),y.success("è¿æ¥å·²åˆ›å»º")}else y.warning("ä¸èƒ½è¿æ¥åˆ°è‡ªèº«")}V.value=!1,U=null,document.removeEventListener("mousemove",le),document.removeEventListener("mouseup",ne)},ve=o=>{(o.target===z.value||o.target===o.currentTarget)&&(o.clientX,o.clientY)},ge=(o,e)=>{o.stopPropagation();let a=!1,v=o.clientX,J=o.clientY,m=e.positionX,C=e.positionY;const l=Y=>{if(!a){const E=Y.clientX-v,$=Y.clientY-J;Math.sqrt(E*E+$*$)>5&&(a=!0)}if(a){const E=(Y.clientX-v)/f.value,$=(Y.clientY-J)/f.value,P=u.value.findIndex(N=>N.id===e.id);P!==-1&&(u.value[P].positionX=m+E,u.value[P].positionY=C+$,console.log("=== è°ƒè¯•ï¼šèŠ‚ç‚¹ç§»åŠ¨ ==="),console.log("ç§»åŠ¨çš„èŠ‚ç‚¹ID:",e.id),console.log("æ–°ä½ç½®:",{x:u.value[P].positionX,y:u.value[P].positionY}),console.log("å½“å‰è¾¹æ•°é‡:",r.value.length),console.log("è¾¹æ•°æ®:",r.value))}},_=()=>{document.removeEventListener("mousemove",l),document.removeEventListener("mouseup",_)};document.addEventListener("mousemove",l),document.addEventListener("mouseup",_)},me=()=>{f.value=Math.min(f.value+.1,2)},we=()=>{f.value=Math.max(f.value-.1,.5)},ye=()=>{f.value=1},_e=()=>{var C,l,_,Y,E,$,P;const o=u.value.filter(N=>N.type==="start"),e=u.value.filter(N=>N.type==="end");if(!S.value.trim()){y.warning("è¯·è¾“å…¥å·¥ä½œæµåç§°");return}if(o.length===0){y.warning("å·¥ä½œæµå¿…é¡»åŒ…å«ä¸€ä¸ªå¼€å§‹èŠ‚ç‚¹");return}if(e.length===0){y.warning("å·¥ä½œæµå¿…é¡»åŒ…å«ä¸€ä¸ªç»“æŸèŠ‚ç‚¹");return}const a=[...u.value],v=[...r.value],J=new Map;a.forEach((N,Q)=>{const te=Q+1;J.set(N.id,te),N.id=te}),v.forEach((N,Q)=>{N.id=Q+1,N.fromNodeId=J.get(N.fromNodeId),N.toNodeId=J.get(N.toNodeId)});const m={id:(C=t.workflow)==null?void 0:C.id,name:S.value,description:p.value,version:s.value,status:((l=t.workflow)==null?void 0:l.status)!==void 0&&((_=t.workflow)==null?void 0:_.status)!==null?t.workflow.status:1,createdBy:(Y=t.workflow)==null?void 0:Y.createdBy,createdAt:(E=t.workflow)==null?void 0:E.createdAt,updatedAt:new Date().toISOString(),isDeleted:(($=t.workflow)==null?void 0:$.isDeleted)!==void 0&&((P=t.workflow)==null?void 0:P.isDeleted)!==null?t.workflow.isDeleted:0,definition:{nodes:a,edges:v}};console.log("=== è°ƒè¯•ï¼šä¿å­˜å·¥ä½œæµæ•°æ® ==="),console.log("ä¿å­˜çš„è¾¹æ•°é‡:",m.definition.edges.length),console.log("ä¿å­˜çš„è¾¹æ•°æ®:",m.definition.edges),console.log("å®Œæ•´å·¥ä½œæµæ•°æ®:",m),T("save",m),y.success("å·¥ä½œæµå·²ä¿å­˜")},ke=()=>{T("run",{nodes:u.value,edges:r.value}),y.success("å·¥ä½œæµå·²å¼€å§‹è¿è¡Œ")};return ie(()=>{console.log("=== è°ƒè¯•ï¼šWorkflowDesignerç»„ä»¶åˆå§‹åŒ– ==="),console.log("æ¥æ”¶åˆ°çš„props.workflow:",t.workflow),t.workflow&&(S.value=t.workflow.name||"",p.value=t.workflow.description||"",s.value=t.workflow.version||"1.0.0",t.workflow.definition&&t.workflow.definition.nodes&&t.workflow.definition.edges?(console.log("=== è°ƒè¯•ï¼šä»props.workflow.definitionä¸­è·å–åˆ°èŠ‚ç‚¹å’Œè¾¹æ•°æ® ==="),console.log("definitionä¸­çš„èŠ‚ç‚¹æ•°é‡:",t.workflow.definition.nodes.length),console.log("definitionä¸­çš„è¾¹æ•°é‡:",t.workflow.definition.edges.length),console.log("definitionä¸­çš„è¾¹æ•°æ®:",t.workflow.definition.edges),u.value=JSON.parse(JSON.stringify(t.workflow.definition.nodes)),r.value=JSON.parse(JSON.stringify(t.workflow.definition.edges)),console.log("=== è°ƒè¯•ï¼šæ·±æ‹·è´å®Œæˆ ==="),console.log("æ·±æ‹·è´åçš„èŠ‚ç‚¹æ•°é‡:",u.value.length),console.log("æ·±æ‹·è´åçš„è¾¹æ•°é‡:",r.value.length),console.log("æ·±æ‹·è´åçš„è¾¹æ•°æ®:",r.value)):t.workflow.nodes&&t.workflow.edges&&(console.log("=== è°ƒè¯•ï¼šä»props.workflowç›´æ¥å±æ€§ä¸­è·å–åˆ°èŠ‚ç‚¹å’Œè¾¹æ•°æ® ==="),console.log("propsä¸­çš„èŠ‚ç‚¹æ•°é‡:",t.workflow.nodes.length),console.log("propsä¸­çš„è¾¹æ•°é‡:",t.workflow.edges.length),console.log("propsä¸­çš„è¾¹æ•°æ®:",t.workflow.edges),u.value=JSON.parse(JSON.stringify(t.workflow.nodes)),r.value=JSON.parse(JSON.stringify(t.workflow.edges)),console.log("=== è°ƒè¯•ï¼šæ·±æ‹·è´å®Œæˆ ==="),console.log("æ·±æ‹·è´åçš„èŠ‚ç‚¹æ•°é‡:",u.value.length),console.log("æ·±æ‹·è´åçš„è¾¹æ•°é‡:",r.value.length),console.log("æ·±æ‹·è´åçš„è¾¹æ•°æ®:",r.value))),console.log("=== è°ƒè¯•ï¼šWorkflowDesignerç»„ä»¶åˆå§‹åŒ–å®Œæˆ ===")}),Ne(()=>t.workflow,o=>{console.log("=== è°ƒè¯•ï¼šå·¥ä½œæµå¯¹è±¡å˜åŒ–ç›‘å¬è§¦å‘ ==="),console.log("æ–°çš„å·¥ä½œæµæ•°æ®:",o),S.value=(o==null?void 0:o.name)||"",p.value=(o==null?void 0:o.description)||"",s.value=(o==null?void 0:o.version)||"1.0.0",o?o.definition&&o.definition.nodes&&o.definition.edges?(console.log("=== è°ƒè¯•ï¼šä»å˜åŒ–åçš„props.workflow.definitionä¸­è·å–èŠ‚ç‚¹å’Œè¾¹æ•°æ® ==="),console.log("å˜åŒ–åçš„èŠ‚ç‚¹æ•°é‡:",o.definition.nodes.length),console.log("å˜åŒ–åçš„è¾¹æ•°é‡:",o.definition.edges.length),console.log("å˜åŒ–åçš„è¾¹æ•°æ®:",o.definition.edges),u.value=JSON.parse(JSON.stringify(o.definition.nodes)),r.value=JSON.parse(JSON.stringify(o.definition.edges)),console.log("=== è°ƒè¯•ï¼šå·¥ä½œæµå¯¹è±¡å˜åŒ–æ›´æ–°å®Œæˆ ==="),console.log("æ›´æ–°åçš„èŠ‚ç‚¹æ•°é‡:",u.value.length),console.log("æ›´æ–°åçš„è¾¹æ•°é‡:",r.value.length),console.log("æ›´æ–°åçš„è¾¹æ•°æ®:",r.value)):o.nodes&&o.edges&&(console.log("=== è°ƒè¯•ï¼šä»å˜åŒ–åçš„props.workflowç›´æ¥å±æ€§ä¸­è·å–èŠ‚ç‚¹å’Œè¾¹æ•°æ® ==="),console.log("å˜åŒ–åçš„èŠ‚ç‚¹æ•°é‡:",o.nodes.length),console.log("å˜åŒ–åçš„è¾¹æ•°é‡:",o.edges.length),console.log("å˜åŒ–åçš„è¾¹æ•°æ®:",o.edges),u.value=JSON.parse(JSON.stringify(o.nodes)),r.value=JSON.parse(JSON.stringify(o.edges)),console.log("=== è°ƒè¯•ï¼šå·¥ä½œæµå¯¹è±¡å˜åŒ–æ›´æ–°å®Œæˆ ==="),console.log("æ›´æ–°åçš„èŠ‚ç‚¹æ•°é‡:",u.value.length),console.log("æ›´æ–°åçš„è¾¹æ•°é‡:",r.value.length),console.log("æ›´æ–°åçš„è¾¹æ•°æ®:",r.value)):(console.log("=== è°ƒè¯•ï¼šæ–°å·¥ä½œæµä¸ºnullï¼Œæ¸…ç©ºèŠ‚ç‚¹å’Œè¾¹ ==="),u.value=[],r.value=[],console.log("=== è°ƒè¯•ï¼šå·¥ä½œæµå¯¹è±¡å˜åŒ–æ›´æ–°å®Œæˆ ==="),console.log("æ›´æ–°åçš„èŠ‚ç‚¹æ•°é‡:",u.value.length),console.log("æ›´æ–°åçš„è¾¹æ•°é‡:",r.value.length),console.log("æ›´æ–°åçš„è¾¹æ•°æ®:",r.value))},{deep:!0}),(o,e)=>{const a=D("el-input"),v=D("el-button"),J=D("el-icon"),m=D("el-form-item"),C=D("el-form");return x(),h("div",Le,[i("div",Ue,[i("div",ze,[n(a,{modelValue:S.value,"onUpdate:modelValue":e[0]||(e[0]=l=>S.value=l),placeholder:"è¾“å…¥å·¥ä½œæµåç§°",size:"small",style:{width:"200px","margin-right":"12px"}},null,8,["modelValue"])]),n(v,{type:"primary",onClick:_e},{default:d(()=>[...e[9]||(e[9]=[O("ä¿å­˜å·¥ä½œæµ",-1)])]),_:1}),n(v,{onClick:ke},{default:d(()=>[...e[10]||(e[10]=[O("è¿è¡Œå·¥ä½œæµ",-1)])]),_:1}),i("div",Be,[n(v,{onClick:me,size:"small"},{default:d(()=>[...e[11]||(e[11]=[O("æ”¾å¤§",-1)])]),_:1}),n(v,{onClick:we,size:"small"},{default:d(()=>[...e[12]||(e[12]=[O("ç¼©å°",-1)])]),_:1}),n(v,{onClick:ye,size:"small"},{default:d(()=>[...e[13]||(e[13]=[O("é‡ç½®ç¼©æ”¾",-1)])]),_:1})])]),i("div",Re,[i("div",Te,[e[14]||(e[14]=i("h3",null,"èŠ‚ç‚¹ç±»å‹",-1)),i("div",Ae,[(x(),h(q,null,W(c,l=>i("div",{key:l.type,class:"node-item",draggable:"true",onDragstart:_=>j(_,l)},[i("div",qe,B(l.icon),1),i("div",Fe,B(l.label),1)],40,je)),64))])]),i("div",{class:"canvas-container",ref_key:"canvasContainer",ref:z,onDragover:G,onDrop:K},[i("div",{class:"canvas",style:se({transform:`scale(${f.value})`,transformOrigin:"center"}),onMousedown:ve},[e[15]||(e[15]=i("div",{class:"grid-background"},null,-1)),(x(),h("svg",{class:"connections-layer",ref_key:"connectionsLayer",ref:A},[(x(!0),h(q,null,W(r.value,l=>(x(),h("line",{key:l.id,x1:X(l.fromNodeId).x+75,y1:X(l.fromNodeId).y+30,x2:X(l.toNodeId).x,y2:X(l.toNodeId).y+30,class:"connection-line"},null,8,He))),128))],512)),(x(!0),h(q,null,W(u.value,l=>(x(),h("div",{key:l.id,class:Ve(["workflow-node",l.type]),style:se({left:`${l.positionX}px`,top:`${l.positionY}px`}),onMousedown:_=>ge(_,l),onClick:_=>M(l)},[i("div",Ke,[i("div",Ze,B(b(l.type)),1),i("div",Qe,B(l.name),1),i("div",We,[n(v,{type:"danger",size:"small",circle:"",onClick:Ie(_=>fe(l),["stop"])},{default:d(()=>[n(J,null,{default:d(()=>[n(F(xe))]),_:1})]),_:1},8,["onClick"])])]),i("div",eo,B(k(l.type)),1),i("div",oo,[i("div",{class:"node-port port-input","data-node-id":l.id,onMousedown:_=>oe(_,l,"input")},null,40,lo),i("div",{class:"node-port port-output","data-node-id":l.id,onMousedown:_=>oe(_,l,"output")},null,40,no)])],46,Ge))),128)),V.value?(x(),h("svg",to,[i("line",{x1:R.value.x+75,y1:R.value.y+30,x2:L.value.x,y2:L.value.y,class:"temp-connection-line"},null,8,so)])):ae("",!0)],36)],544),i("div",ao,[w.value?(x(),h("div",uo,[e[17]||(e[17]=i("h3",null,"èŠ‚ç‚¹å±æ€§",-1)),n(C,{"label-position":"top",size:"small"},{default:d(()=>[n(m,{label:"èŠ‚ç‚¹åç§°"},{default:d(()=>[n(a,{modelValue:w.value.name,"onUpdate:modelValue":e[4]||(e[4]=l=>w.value.name=l),onInput:de},null,8,["modelValue"])]),_:1}),n(m,{label:"èŠ‚ç‚¹ç±»å‹"},{default:d(()=>[n(a,{modelValue:w.value.type,"onUpdate:modelValue":e[5]||(e[5]=l=>w.value.type=l),disabled:""},null,8,["modelValue"])]),_:1}),w.value.type==="llm_call"?(x(),h(q,{key:0},[n(m,{label:"ç³»ç»Ÿæç¤ºè¯"},{default:d(()=>[n(a,{modelValue:I.value.systemPrompt,"onUpdate:modelValue":e[6]||(e[6]=l=>I.value.systemPrompt=l),type:"textarea",rows:4,onInput:Z},null,8,["modelValue"])]),_:1}),n(m,{label:"ç”¨æˆ·æç¤ºè¯æ¨¡æ¿"},{default:d(()=>[n(a,{modelValue:I.value.userPrompt,"onUpdate:modelValue":e[7]||(e[7]=l=>I.value.userPrompt=l),type:"textarea",rows:4,onInput:Z,placeholder:"ä½¿ç”¨${å˜é‡å}æ¥å¼•ç”¨ä¸Šä¸‹æ–‡å˜é‡"},null,8,["modelValue"])]),_:1}),n(m,{label:"è¾“å‡ºå˜é‡å"},{default:d(()=>[n(a,{modelValue:I.value.outputVar,"onUpdate:modelValue":e[8]||(e[8]=l=>I.value.outputVar=l),onInput:Z},null,8,["modelValue"])]),_:1})],64)):ae("",!0)]),_:1})])):(x(),h("div",io,[e[16]||(e[16]=i("h3",null,"å·¥ä½œæµå±æ€§",-1)),n(C,{"label-position":"top",size:"small"},{default:d(()=>[n(m,{label:"å·¥ä½œæµåç§°"},{default:d(()=>[n(a,{modelValue:S.value,"onUpdate:modelValue":e[1]||(e[1]=l=>S.value=l),onInput:re},null,8,["modelValue"])]),_:1}),n(m,{label:"å·¥ä½œæµæè¿°"},{default:d(()=>[n(a,{modelValue:p.value,"onUpdate:modelValue":e[2]||(e[2]=l=>p.value=l),type:"textarea",rows:3,onInput:ce},null,8,["modelValue"])]),_:1}),n(m,{label:"å·¥ä½œæµç‰ˆæœ¬"},{default:d(()=>[n(a,{modelValue:s.value,"onUpdate:modelValue":e[3]||(e[3]=l=>s.value=l),onInput:pe},null,8,["modelValue"])]),_:1})]),_:1})]))])])])}}},co=ue(ro,[["__scopeId","data-v-375cd267"]]),po={class:"workflow-designer-view"},fo={class:"view-header"},vo={class:"header-actions"},go={class:"designer-wrapper"},mo={class:"dialog-footer"},wo={__name:"WorkflowDesignerView",setup(ee){const H=Oe(),t=De(),T=Pe(),c=g({id:null,name:"",description:"",version:"1.0.0",status:1,nodes:[],edges:[]}),u=g(!1),r=g(!1),w=g(!1),f=g(!1),V=he({name:"",inputParams:"{}"}),R=()=>{H.push("/workflows")},L=()=>{Ce.confirm("ç¡®å®šè¦é‡ç½®å·¥ä½œæµå—ï¼Ÿè¿™å°†æ¸…é™¤å½“å‰æ‰€æœ‰è®¾è®¡å†…å®¹ã€‚","è­¦å‘Š",{confirmButtonText:"ç¡®å®š",cancelButtonText:"å–æ¶ˆ",type:"warning"}).then(()=>{c.value={id:c.value.id,name:"",description:"",version:"1.0.0",status:1,nodes:[],edges:[]},y.success("å·¥ä½œæµå·²é‡ç½®")}).catch(()=>{})},U=p=>{console.log("=== è°ƒè¯•ï¼šå¼€å§‹åŠ è½½å·¥ä½œæµå®šä¹‰ ==="),console.log("åŠ è½½çš„å·¥ä½œæµID:",p),Xe(p).then(s=>{var k,b;console.log("=== è°ƒè¯•ï¼šè·å–åˆ°å·¥ä½œæµå®šä¹‰ ==="),console.log("APIå“åº”å®Œæ•´æ•°æ®:",s),c.value=s.data,console.log("=== è°ƒè¯•ï¼šå·¥ä½œæµæ•°æ®èµ‹å€¼å®Œæˆ ==="),console.log("æœ€ç»ˆå·¥ä½œæµæ•°æ®:",c.value),console.log("æœ€ç»ˆdefinition:",c.value.definition),c.value.definition&&typeof c.value.definition=="string"&&(c.value.definition=JSON.parse(c.value.definition)),c.value.definition&&(console.log("æœ€ç»ˆèŠ‚ç‚¹æ•°é‡:",(k=c.value.definition.nodes)==null?void 0:k.length),console.log("æœ€ç»ˆè¾¹æ•°é‡:",(b=c.value.definition.edges)==null?void 0:b.length))}).catch(s=>{console.error("=== è°ƒè¯•ï¼šåŠ è½½å·¥ä½œæµå¤±è´¥ ==="),console.error("é”™è¯¯ä¿¡æ¯:",s),y.error("åŠ è½½å·¥ä½œæµå¤±è´¥"),console.error("åŠ è½½å·¥ä½œæµå¤±è´¥:",s),c.value={id:p,name:"ç¤ºä¾‹å·¥ä½œæµ",description:"è¿™æ˜¯ä¸€ä¸ªç¤ºä¾‹å·¥ä½œæµ",version:"1.0.0",status:1,definition:{nodes:[{id:1,name:"å¼€å§‹èŠ‚ç‚¹",type:"start",positionX:100,positionY:200,configJson:"{}"},{id:2,name:"å¤§æ¨¡å‹è°ƒç”¨",type:"llm_call",positionX:300,positionY:200,configJson:'{"systemPrompt": "ä½ æ˜¯ä¸€ä¸ªAIåŠ©æ‰‹", "userPrompt": "è¯·å›ç­”ï¼š${question}", "outputVar": "answer"}'},{id:3,name:"ç»“æŸèŠ‚ç‚¹",type:"end",positionX:500,positionY:200,configJson:"{}"}],edges:[{id:1,fromNodeId:1,toNodeId:2},{id:2,fromNodeId:2,toNodeId:3}]}}})},z=p=>{r.value=!0,console.log("=== è°ƒè¯•ï¼šå¼€å§‹ä¿å­˜å·¥ä½œæµ ==="),console.log("ä¿å­˜çš„å·¥ä½œæµæ•°æ®:",p),(u.value?Ee(p.id,p):$e(p)).then(k=>{console.log("=== è°ƒè¯•ï¼šä¿å­˜å·¥ä½œæµæˆåŠŸ ==="),console.log("APIå“åº”æ•°æ®:",k),y.success("å·¥ä½œæµå·²ä¿å­˜"),k.data?(c.value=k.data,u.value=!0,console.log("=== è°ƒè¯•ï¼šå·¥ä½œæµæ•°æ®æ›´æ–°å®Œæˆ ==="),console.log("æ›´æ–°åçš„å·¥ä½œæµæ•°æ®:",c.value),console.log("æ›´æ–°åçš„definition:",c.value.definition)):(console.log("=== è°ƒè¯•ï¼šå·¥ä½œæµæ•°æ®æ›´æ–°å®Œæˆ ==="),console.log("APIè¿”å›æ•°æ®ä¸ºnullï¼Œä¿æŒåŸæœ‰å·¥ä½œæµæ•°æ®"))}).catch(k=>{console.error("=== è°ƒè¯•ï¼šä¿å­˜å·¥ä½œæµå¤±è´¥ ==="),console.error("é”™è¯¯ä¿¡æ¯:",k),y.error("ä¿å­˜å·¥ä½œæµå¤±è´¥"),console.error("ä¿å­˜å·¥ä½œæµå¤±è´¥:",k)}).finally(()=>{r.value=!1})},A=()=>{f.value=!0,V.name=c.value.name+"_å®ä¾‹",V.inputParams="{}"},I=p=>{A()},S=()=>{w.value=!0,f.value=!1;let p={};try{p=JSON.parse(V.inputParams)}catch{y.error("è¾“å…¥å‚æ•°æ ¼å¼é”™è¯¯ï¼Œè¯·è¾“å…¥æœ‰æ•ˆçš„JSONæ ¼å¼"),w.value=!1;return}Ye(c.value.id,p).then(s=>{y.success("å·¥ä½œæµå·²å¼€å§‹è¿è¡Œ")}).catch(s=>{y.error("è¿è¡Œå·¥ä½œæµå¤±è´¥"),console.error("è¿è¡Œå·¥ä½œæµå¤±è´¥:",s),y.success("å·¥ä½œæµå·²å¼€å§‹è¿è¡Œ")}).finally(()=>{w.value=!1})};return ie(()=>{const p=t.query.id;p?(u.value=!0,U(Number(p))):c.value={id:null,name:"",description:"",version:"1.0.0",status:1,nodes:[],edges:[]}}),(p,s)=>{const k=D("el-icon"),b=D("el-button"),X=D("el-input"),j=D("el-form-item"),G=D("el-form"),K=D("el-dialog");return x(),Se(Me,{userInfo:F(T).userInfo},{default:d(()=>[i("div",po,[i("div",fo,[i("h1",null,B(u.value?"ç¼–è¾‘å·¥ä½œæµ":"åˆ›å»ºå·¥ä½œæµ"),1),i("div",vo,[n(b,{onClick:R},{default:d(()=>[n(k,null,{default:d(()=>[n(F(be))]),_:1}),s[4]||(s[4]=O(" è¿”å›åˆ—è¡¨ ",-1))]),_:1}),n(b,{type:"warning",onClick:L},{default:d(()=>[...s[5]||(s[5]=[O("é‡ç½®",-1)])]),_:1}),n(b,{type:"success",onClick:A,loading:w.value},{default:d(()=>[n(k,null,{default:d(()=>[n(F(Je))]),_:1}),s[6]||(s[6]=O(" è¿è¡Œå·¥ä½œæµ ",-1))]),_:1},8,["loading"])])]),i("div",go,[n(co,{workflow:c.value,onSave:z,onRun:I},null,8,["workflow"])]),n(K,{modelValue:f.value,"onUpdate:modelValue":s[3]||(s[3]=M=>f.value=M),title:"è¿è¡Œå·¥ä½œæµ",width:"500px",center:""},{footer:d(()=>[i("span",mo,[n(b,{onClick:s[2]||(s[2]=M=>f.value=!1)},{default:d(()=>[...s[7]||(s[7]=[O("å–æ¶ˆ",-1)])]),_:1}),n(b,{type:"primary",onClick:S},{default:d(()=>[...s[8]||(s[8]=[O("ç¡®å®šè¿è¡Œ",-1)])]),_:1})])]),default:d(()=>[n(G,{"label-position":"top",size:"small"},{default:d(()=>[n(j,{label:"å·¥ä½œæµåç§°"},{default:d(()=>[n(X,{modelValue:V.name,"onUpdate:modelValue":s[0]||(s[0]=M=>V.name=M),placeholder:"è¾“å…¥å·¥ä½œæµå®ä¾‹åç§°"},null,8,["modelValue"])]),_:1}),n(j,{label:"è¾“å…¥å‚æ•°"},{default:d(()=>[n(X,{modelValue:V.inputParams,"onUpdate:modelValue":s[1]||(s[1]=M=>V.inputParams=M),type:"textarea",rows:6,placeholder:'è¾“å…¥JSONæ ¼å¼çš„å‚æ•°ï¼Œä¾‹å¦‚ï¼š{"question": "ä½ å¥½"}'},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])]),_:1},8,["userInfo"])}}},xo=ue(wo,[["__scopeId","data-v-45d61d59"]]);export{xo as default};
