import{L as re}from"./Layout-kDhWiEU5.js";import{u as pe}from"./userStore-DdKhfmJw.js";import{k as Q}from"./knowledge-BoDnE9ea.js";import{_ as me}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as d,h as fe,i as D,o as y,w as t,b as s,d as l,e as p,c as R,f as u,t as x,C as ve,D as ge,k as ce,E as v,B as X}from"./index-g6aQcVIG.js";import"./agent-CEcTJNdc.js";const we={class:"resource-view"},_e={class:"tab-header"},be={class:"config-preview"},ye={key:1,class:"empty-tip"},Ve={class:"tab-header"},ke={class:"config-preview"},Ie={key:1,class:"empty-tip"},Ae={class:"tab-header"},xe={class:"dialog-footer"},Ce={class:"dialog-footer"},Te={class:"dialog-footer"},K="api_config_templates",F="plugin_config_templates",Se={__name:"KnowledgeView",setup(De){const V=pe(),M=d("api"),m=d([]),k=d(!1),g=d({name:"",config:""}),C=d(-1),f=d([]),I=d(!1),c=d({name:"",config:""}),T=d(-1),J=d([]),P=d(!1),A=d(!1),r=d({file:null,name:"",description:"",agentId:""}),U=d([]),$=d(!1),G=a=>{try{const e=localStorage.getItem(a);return e?JSON.parse(e):[]}catch(e){return console.error("加载模板失败:",e),[]}},S=(a,e)=>{localStorage.setItem(a,JSON.stringify(e))},Y=()=>{m.value=G(K)},W=()=>{f.value=G(F)},j=(a,e)=>{a?(g.value={...a},C.value=e):(g.value={name:"",config:""},C.value=-1),k.value=!0},Z=()=>{var n;const a=(n=g.value.name)==null?void 0:n.trim();if(!a){v.warning("请输入模板名称");return}const e={...g.value,name:a,createdAt:g.value.createdAt||new Date().toISOString()};if(C.value>=0)m.value.splice(C.value,1,e);else{const i=m.value.findIndex(_=>_.name===a);i>=0?m.value.splice(i,1,e):m.value.push(e)}S(K,m.value),v.success("API 模板已保存到本地浏览器"),k.value=!1},h=a=>{X.confirm("确定要删除该 API 模板吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{m.value.splice(a,1),S(K,m.value),v.success("已删除 API 模板")}).catch(()=>{})},q=(a,e)=>{a?(c.value={...a},T.value=e):(c.value={name:"",config:""},T.value=-1),I.value=!0},ee=()=>{var n;const a=(n=c.value.name)==null?void 0:n.trim();if(!a){v.warning("请输入模板名称");return}const e={...c.value,name:a,createdAt:c.value.createdAt||new Date().toISOString()};if(T.value>=0)f.value.splice(T.value,1,e);else{const i=f.value.findIndex(_=>_.name===a);i>=0?f.value.splice(i,1,e):f.value.push(e)}S(F,f.value),v.success("插件模板已保存到本地浏览器"),I.value=!1},le=a=>{X.confirm("确定要删除该插件模板吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{f.value.splice(a,1),S(F,f.value),v.success("已删除插件模板")}).catch(()=>{})},B=a=>{if(!a)return"";try{return new Date(a).toLocaleString()}catch{return a}},H=a=>{if(!a)return"";const e=String(a).replace(/\s+/g," ");return e.length>80?`${e.slice(0,80)}...`:e},N=async()=>{P.value=!0;try{const a=await Q.listKnowledgeBases();J.value=Array.isArray(a)?a:a.data||[]}catch(a){console.error("加载知识库列表失败:",a),v.error("加载知识库列表失败")}finally{P.value=!1}},te=()=>{r.value={file:null,name:"",description:"",agentId:""},U.value=[],A.value=!0},ae=(a,e)=>{r.value.file=a.raw,U.value=e.slice(-1),r.value.name||(r.value.name=a.name)},oe=async()=>{if(!r.value.file){v.warning("请先选择要上传的文件");return}$.value=!0;try{const{file:a,name:e,description:n,agentId:i}=r.value;await Q.uploadKnowledge({file:a,name:e,description:n,agentId:i?Number(i):void 0}),v.success("上传成功，系统会自动进行拆分和向量化"),A.value=!1,N()}catch(a){console.error("上传知识库失败:",a),v.error("上传失败，请检查文件格式或稍后重试")}finally{$.value=!1}},ne=()=>{N()};return fe(async()=>{if(V&&!V.initialized&&V.initializeUserInfo)try{await V.initializeUserInfo()}catch(a){console.error("初始化用户信息失败:",a)}Y(),W(),N()}),(a,e)=>{const n=p("el-button"),i=p("el-table-column"),_=p("el-table"),E=p("el-tab-pane"),ie=p("el-tabs"),se=p("el-card"),b=p("el-input"),w=p("el-form-item"),L=p("el-form"),z=p("el-dialog"),ue=p("el-upload"),de=ge("loading");return y(),D(re,{userInfo:ce(V).userInfo},{default:t(()=>[s("div",we,[l(se,{class:"box-card"},{header:t(()=>[...e[16]||(e[16]=[s("div",{class:"card-header"},[s("span",null,"资源库")],-1)])]),default:t(()=>[l(ie,{modelValue:M.value,"onUpdate:modelValue":e[2]||(e[2]=o=>M.value=o)},{default:t(()=>[l(E,{label:"API 模板",name:"api"},{default:t(()=>[s("div",_e,[l(n,{type:"primary",onClick:e[0]||(e[0]=o=>j())},{default:t(()=>[...e[17]||(e[17]=[u("新建模板",-1)])]),_:1}),l(n,{onClick:Y},{default:t(()=>[...e[18]||(e[18]=[u("刷新",-1)])]),_:1})]),m.value.length>0?(y(),D(_,{key:0,data:m.value,size:"small",style:{width:"100%"}},{default:t(()=>[l(i,{prop:"name",label:"名称",width:"180"}),l(i,{label:"内容预览","min-width":"260"},{default:t(o=>[s("span",be,x(H(o.row.config)),1)]),_:1}),l(i,{prop:"createdAt",label:"创建时间",width:"180"},{default:t(o=>[s("span",null,x(B(o.row.createdAt)),1)]),_:1}),l(i,{label:"操作",width:"160"},{default:t(o=>[l(n,{type:"primary",link:"",size:"small",onClick:O=>j(o.row,o.$index)},{default:t(()=>[...e[19]||(e[19]=[u(" 编辑 ",-1)])]),_:1},8,["onClick"]),l(n,{type:"danger",link:"",size:"small",onClick:O=>h(o.$index)},{default:t(()=>[...e[20]||(e[20]=[u(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])):(y(),R("div",ye," 暂无 API 模板，可以在「Agent配置」中保存，或点击上方「新建模板」。 "))]),_:1}),l(E,{label:"插件模板",name:"plugin"},{default:t(()=>[s("div",Ve,[l(n,{type:"primary",onClick:e[1]||(e[1]=o=>q())},{default:t(()=>[...e[21]||(e[21]=[u("新建模板",-1)])]),_:1}),l(n,{onClick:W},{default:t(()=>[...e[22]||(e[22]=[u("刷新",-1)])]),_:1})]),f.value.length>0?(y(),D(_,{key:0,data:f.value,size:"small",style:{width:"100%"}},{default:t(()=>[l(i,{prop:"name",label:"名称",width:"180"}),l(i,{label:"内容预览","min-width":"260"},{default:t(o=>[s("span",ke,x(H(o.row.config)),1)]),_:1}),l(i,{prop:"createdAt",label:"创建时间",width:"180"},{default:t(o=>[s("span",null,x(B(o.row.createdAt)),1)]),_:1}),l(i,{label:"操作",width:"160"},{default:t(o=>[l(n,{type:"primary",link:"",size:"small",onClick:O=>q(o.row,o.$index)},{default:t(()=>[...e[23]||(e[23]=[u(" 编辑 ",-1)])]),_:1},8,["onClick"]),l(n,{type:"danger",link:"",size:"small",onClick:O=>le(o.$index)},{default:t(()=>[...e[24]||(e[24]=[u(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])):(y(),R("div",Ie," 暂无插件模板，可以在「Agent配置」中保存，或点击上方「新建模板」。 "))]),_:1}),l(E,{label:"知识库",name:"knowledge"},{default:t(()=>[s("div",Ae,[l(n,{type:"primary",onClick:te},{default:t(()=>[...e[25]||(e[25]=[u("上传知识文件",-1)])]),_:1}),l(n,{onClick:ne},{default:t(()=>[...e[26]||(e[26]=[u("刷新",-1)])]),_:1})]),ve((y(),D(_,{data:J.value,style:{width:"100%"}},{default:t(()=>[l(i,{prop:"id",label:"ID",width:"80"}),l(i,{prop:"name",label:"名称","min-width":"180"}),l(i,{prop:"description",label:"描述","min-width":"220","show-overflow-tooltip":""}),l(i,{prop:"createdAt",label:"创建时间",width:"180"},{default:t(o=>[s("span",null,x(B(o.row.createdAt)),1)]),_:1})]),_:1},8,["data"])),[[de,P.value]])]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(z,{modelValue:k.value,"onUpdate:modelValue":e[6]||(e[6]=o=>k.value=o),title:"编辑 API 模板",width:"600px"},{footer:t(()=>[s("span",xe,[l(n,{onClick:e[5]||(e[5]=o=>k.value=!1)},{default:t(()=>[...e[27]||(e[27]=[u("取 消",-1)])]),_:1}),l(n,{type:"primary",onClick:Z},{default:t(()=>[...e[28]||(e[28]=[u("保 存",-1)])]),_:1})])]),default:t(()=>[l(L,{"label-width":"80px"},{default:t(()=>[l(w,{label:"名称"},{default:t(()=>[l(b,{modelValue:g.value.name,"onUpdate:modelValue":e[3]||(e[3]=o=>g.value.name=o),placeholder:"请输入模板名称"},null,8,["modelValue"])]),_:1}),l(w,{label:"内容"},{default:t(()=>[l(b,{modelValue:g.value.config,"onUpdate:modelValue":e[4]||(e[4]=o=>g.value.config=o),type:"textarea",rows:8,placeholder:"请输入 API 配置内容，可为纯文本或 JSON"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(z,{modelValue:I.value,"onUpdate:modelValue":e[10]||(e[10]=o=>I.value=o),title:"编辑插件模板",width:"600px"},{footer:t(()=>[s("span",Ce,[l(n,{onClick:e[9]||(e[9]=o=>I.value=!1)},{default:t(()=>[...e[29]||(e[29]=[u("取 消",-1)])]),_:1}),l(n,{type:"primary",onClick:ee},{default:t(()=>[...e[30]||(e[30]=[u("保 存",-1)])]),_:1})])]),default:t(()=>[l(L,{"label-width":"80px"},{default:t(()=>[l(w,{label:"名称"},{default:t(()=>[l(b,{modelValue:c.value.name,"onUpdate:modelValue":e[7]||(e[7]=o=>c.value.name=o),placeholder:"请输入模板名称"},null,8,["modelValue"])]),_:1}),l(w,{label:"内容"},{default:t(()=>[l(b,{modelValue:c.value.config,"onUpdate:modelValue":e[8]||(e[8]=o=>c.value.config=o),type:"textarea",rows:8,placeholder:"请输入插件配置内容，建议为 JSON 格式"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(z,{modelValue:A.value,"onUpdate:modelValue":e[15]||(e[15]=o=>A.value=o),title:"上传知识文件",width:"500px"},{footer:t(()=>[s("span",Te,[l(n,{onClick:e[14]||(e[14]=o=>A.value=!1)},{default:t(()=>[...e[34]||(e[34]=[u("取 消",-1)])]),_:1}),l(n,{type:"primary",loading:$.value,onClick:oe},{default:t(()=>[...e[35]||(e[35]=[u("上 传",-1)])]),_:1},8,["loading"])])]),default:t(()=>[l(L,{model:r.value,"label-width":"80px"},{default:t(()=>[l(w,{label:"文件"},{default:t(()=>[l(ue,{class:"upload-demo",drag:"","auto-upload":!1,limit:1,"file-list":U.value,"on-change":ae},{tip:t(()=>[...e[31]||(e[31]=[s("div",{class:"el-upload__tip"}," 支持 PDF / Word / Markdown 等常见格式，单个文件不要太大。 ",-1)])]),default:t(()=>[e[32]||(e[32]=s("i",{class:"el-icon-upload"},null,-1)),e[33]||(e[33]=s("div",{class:"el-upload__text"},[u(" 将文件拖到此处，或"),s("em",null,"点击上传")],-1))]),_:1},8,["file-list"])]),_:1}),l(w,{label:"名称"},{default:t(()=>[l(b,{modelValue:r.value.name,"onUpdate:modelValue":e[11]||(e[11]=o=>r.value.name=o),placeholder:"可选，不填则使用文件名"},null,8,["modelValue"])]),_:1}),l(w,{label:"描述"},{default:t(()=>[l(b,{modelValue:r.value.description,"onUpdate:modelValue":e[12]||(e[12]=o=>r.value.description=o),type:"textarea",rows:3,placeholder:"可选，对知识库做一个简单说明"},null,8,["modelValue"])]),_:1}),l(w,{label:"绑定Agent"},{default:t(()=>[l(b,{modelValue:r.value.agentId,"onUpdate:modelValue":e[13]||(e[13]=o=>r.value.agentId=o),placeholder:"可选，填写要绑定的 Agent ID（暂时先用数字ID）"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])]),_:1},8,["userInfo"])}}},Le=me(Se,[["__scopeId","data-v-1debda75"]]);export{Le as default};
