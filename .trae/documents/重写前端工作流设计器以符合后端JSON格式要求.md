# 重写前端工作流设计器计划

## 问题分析

当前前端工作流设计器生成的JSON格式与后端要求不匹配，主要差异包括：

* 节点使用`id`字段，后端要求`key`字段

* 边使用`fromNodeId`和`toNodeId`字段，后端要求`fromNode`和`toNode`字段

* 缺少完整的`globalVariables`实现

* 边的条件处理过于简单

## 核心修改点

### 1. 修改节点数据结构

* 将节点的`id`字段改为`key`字段

* 确保节点`key`的唯一性和可读性

* 节点配置保持不变，确保与后端要求匹配

### 2. 修改边（transitions）数据结构

* 将`edges`数组重命名为`transitions`

* 将`fromNodeId`和`toNodeId`改为`fromNode`和`toNode`

* 引用节点的`key`而非`id`

* 实现条件表达式的编辑功能

### 3. 实现globalVariables管理

* 添加全局变量的添加、编辑、删除功能

* 支持变量类型和初始值的设置

* 确保变量在节点配置中可以被引用

### 4. 修改数据转换逻辑

* 在保存工作流时，确保生成符合后端要求的JSON格式

* 在加载工作流时，正确解析后端返回的JSON格式

### 5. 增强节点配置功能

* 支持更多节点类型的配置

* 确保节点配置与后端要求一致

## 修改文件列表

### 1. 主要组件修改

* **WorkflowDesigner.vue**：核心设计器组件，修改节点和边的处理逻辑

* **WorkflowDesignerView\.vue**：视图组件，确保正确传递和处理工作流数据

### 2. 数据处理修改

* **workflow\.js**：API调用文件，确保数据格式正确

## 实现步骤

1. **修改节点数据结构**：

   * 将节点创建时的`id`改为`key`

   * 使用更有意义的`key`命名方式

2. **修改边数据结构**：

   * 将`edges`重命名为`transitions`

   * 修改连接逻辑，使用节点`key`

   * 添加条件编辑功能

3. **实现globalVariables管理**：

   * 添加全局变量面板

   * 实现变量的CRUD操作

4. **修改数据转换和保存逻辑**：

   * 确保保存时生成正确的JSON格式

   * 确保加载时正确解析后端数据

5. **测试和验证**：

   * 测试工作流的创建、保存、加载功能

   * 确保生成的JSON格式符合后端要求

## 预期结果

* 前端能够正确生成后端要求的工作流JSON格式

* 支持完整的工作流设计功能

* 能够正确加载和处理后端返回的工作流数据

* 提供良好的用户体验，支持复杂工作流的设计

