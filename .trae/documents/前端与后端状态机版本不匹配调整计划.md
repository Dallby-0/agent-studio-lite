## 1. 问题分析

当前前端与后端状态机版本存在以下不匹配：

| 方面       | 前端实现                                         | 后端状态机版本                             |
| -------- | -------------------------------------------- | ----------------------------------- |
| API端点    | `/api/workflows`                             | `/api/state-workflows`              |
| 工作流执行API | `/api/workflow-instances/start/{workflowId}` | `/api/state-workflows/{id}/execute` |
| 数据结构     | 期望DAG结构（nodes和edges）                         | 使用JSON定义（definition字段）              |
| 实例管理API  | `/api/workflow-instances`                    | `/api/state-workflows/instances`    |
| 工作流设计    | 基于DAG的节点和边设计                                 | 基于状态机的JSON定义                        |

## 2. 调整方案

### 2.1 更新API调用

修改 `workflow.js` 文件，将API调用更新为状态机版本的端点：

* 将所有 `/api/workflows` 调用替换为 `/api/state-workflows`

* 将 `/api/workflow-instances/start/{workflowId}` 替换为 `/api/state-workflows/{id}/execute`

* 更新实例管理API调用为状态机版本

### 2.2 调整数据处理逻辑

* 修改 `WorkflowsView.vue` 以适应状态机工作流列表数据

* 更新 `WorkflowDesignerView.vue` 以处理状态机工作流定义

* 调整工作流保存逻辑，支持状态机JSON格式

### 2.3 调整工作流设计器

* 修改 `WorkflowDesigner.vue` 组件，支持状态机工作流设计

* 调整节点和边的处理逻辑，生成状态机JSON定义

### 2.4 更新执行和实例管理

* 修改 `executeWorkflow` 方法，使用新的执行API

* 更新状态轮询和结果获取逻辑，使用新的实例API

* 调整执行日志和结果的处理逻辑

## 3. 实施步骤

1. **更新API调用**：修改 `workflow.js` 文件，更新所有API端点
2. **调整工作流列表**：修改 `WorkflowsView.vue` 以适应状态机工作流列表
3. **调整工作流设计器**：修改 `WorkflowDesignerView.vue` 和 `WorkflowDesigner.vue` 以支持状态机工作流定义
4. **更新执行逻辑**：修改执行和实例管理逻辑
5. **测试验证**：确保所有功能正常工作

## 4. 预期效果

* 前端能够成功调用后端状态机API

* 工作流列表能够正常显示

* 工作流设计器能够创建和编辑状态机工作流

* 工作流执行和实例管理功能正常

## 5. 技术要点

* 完全不用考虑兼容性，尽可能保证新版本正常运行

* 正确处理状态机工作流的JSON定义

* 确保工作流执行和实例管理功能正常

* 调整UI以适应状态机工作流的特点

* 模块间连线用曲线，连线尽量不要穿过模块

* 添加或保留重要的调试信息（例如保存工作流时输出json）

